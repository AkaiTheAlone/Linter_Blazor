@inject Dados.Repositorios.CAX001_MovimentacoesRepositorio repCaixa
@page "/relatorios"
@rendermode InteractiveServer
@inject IJSRuntime js
@inject FastRelatorios repRelatorio

<h3 class="centralizado">Relatórios</h3>


<FluentAppBar Orientation="Orientation.Vertical">
    <FluentAppBarItem IconRest="@(new Icons.Regular.Size24.ChartMultiple())" Text="Gerar Relatório de Movimentações" OnClick="GerarRelatorioMovimentacoes">  </FluentAppBarItem>
    <FluentAppBarItem IconRest="@(new Icons.Regular.Size24.ChartPerson())" Text="Gerar Lista de Usuários" OnClick="ListarUsuarios">  </FluentAppBarItem>
    <FluentAppBarItem IconRest="@(new Icons.Regular.Size24.ChartMultiple())" Text="Gerar Lista de Usuários">  </FluentAppBarItem>
</FluentAppBar>


@code {

    public Modelos.Modelos.CAX001_Movimentacoes Movimentacao { get; set; }
    public string pdfBase64 { get; set; }

    public async void GerarRelatorioMovimentacoes()
    {
        var movimentacoes = await repCaixa.RetornaMovimentacoesParaRPT();

        var bytes = await repRelatorio.GerarRelatorio(movimentacoes, "movimentacoes");
        pdfBase64 = Convert.ToBase64String(bytes);
        await Task.Delay(100);

        await js.InvokeVoidAsync("eval", $@"
        var newWindow = window.open('', '_blank');
        newWindow.document.write('<html><head><title>PDF</title></head><body>');
        newWindow.document.write('<embed src=""data:application/pdf;base64,{pdfBase64}"" width=""100%"" height=""100%"" />');
        newWindow.document.write('</body></html>');");
    }
    public async void ListarUsuarios()
    {
        var usuarios = await repCaixa.RetornaMovimentacoesParaRPT();

        var bytes = await repRelatorio.GerarRelatorio2(usuarios, "usuarios");
        pdfBase64 = Convert.ToBase64String(bytes);

        await js.InvokeVoidAsync("eval", $@"
        var newWindow = window.open('', '_blank');
        newWindow.document.write('<html><head><title>PDF</title></head><body>');
        newWindow.document.write('<embed src=""data:application/pdf;base64,{pdfBase64}"" width=""100%"" height=""100%"" />');
        newWindow.document.write('</body></html>');");
    }
}

